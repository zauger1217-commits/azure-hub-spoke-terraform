# Azure Hub-and-Spoke Terraform Lab ☁️

> **Terraform-built Azure hub-and-spoke architecture**
> focused on networking fundamentals, security boundaries, and real-world troubleshooting.

---

## What This Is

- An **Azure hub-and-spoke network** built with **Terraform**
- Uses **modules** to separate networking, security, and compute
- Designed to reflect **real cloud operations patterns**, not toy examples

Some VM access during early iterations used **ClickOps / RDP** while validating networking.
The infrastructure itself is fully provisioned via Terraform.

---

## Architecture Overview

**Hub**
- Virtual network: `vnet-hub`
- Workload subnet + private endpoint subnet
- Linux VM acting as a **jump host**
- Storage account with **Private Endpoint**

**Spokes**
- Two spoke VNets
- Workload subnets only
- Linux VMs with **no public IPs**

**Connectivity**
- Hub ↔ Spoke VNet peering
- Central Network Security Group (NSG)
- Hub subnet allowed to reach spokes over SSH

---

## Repository Layout

```
.
├─ main.tf
├─ variables.tf
├─ locals.tf
├─ providers.tf
├─ versions.tf
├─ outputs.tf
├─ terraform.tfvars.example
├─ modules/
│  ├─ rg/
│  ├─ network-hub/
│  ├─ network-spoke/
│  ├─ nsg/
│  ├─ nsg-subnet-assoc/
│  ├─ nsg-nic-assoc/
│  ├─ vm-linux/
│  ├─ peering/
│  └─ private-endpoint-storage/
└─ docs/
   ├─ architecture.md
   └─ troubleshooting.md
```

---

## How to Deploy

### Prerequisites
- Azure subscription
- Azure CLI authenticated (`az login`)
- Terraform installed

### Deploy the Lab

```bash
cp terraform.tfvars.example terraform.tfvars

terraform init
terraform validate
terraform apply
```

### Tear Down

```bash
terraform destroy
```

---

## Network & Access Model

- Spoke VMs have **no public IPs**
- Public SSH allowed only from **your IP** (lab convenience)
- Hub VM provides private access to spokes
- NSG rules dynamically reference subnet CIDRs (no hardcoding)

---

## What This Project Demonstrates

- Terraform module composition
- Azure hub-and-spoke networking
- NSG rule design and source scoping
- Private routing and VNet peering
- Troubleshooting Azure SKU capacity and quotas
- Practical separation of concerns

---

## Real Issues Encountered

- VM creation failures due to **regional SKU capacity**
- Subscription quota limits blocking VM families
- Incorrect NSG source prefixes causing timeouts
- SSH authentication differences between local, hub, and spoke access

These issues are documented in `docs/troubleshooting.md`.

---

## Next Improvements

- Replace public SSH with Azure Bastion
- Add NSG flow logs and Azure Monitor
- Introduce CI validation (Terraform fmt / validate)
- Harden jump host access

---

## Why This Exists

This lab was built to practice **Azure networking fundamentals**
and **Terraform best practices** while encountering the kinds of
issues faced in real cloud operations roles.
