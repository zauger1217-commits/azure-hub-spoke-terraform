# Azure Hub-and-Spoke Terraform Lab â˜ï¸

A modular **Azure hub-and-spoke network** built with **Terraform**, focused on real-world
networking patterns, security boundaries, and operational troubleshooting.

This project emphasizes **Infrastructure as Code** over VM configuration.
Some VM access and validation during early iterations was performed using **ClickOps / RDP**.

---

## ğŸ§± Architecture at a Glance

- Hub virtual network (`vnet-hub`)
- Two spoke virtual networks
- Hub â†” Spoke VNet peering
- Centralized Network Security Group (NSG)
- Linux VMs (hub + spokes)
- Storage account with Private Endpoint (hub)

The **hub VM acts as a jump point** for private access to spoke workloads.

---

## ğŸ“‚ Repository Structure

```
.
â”œâ”€â”€ main.tf
â”œâ”€â”€ variables.tf
â”œâ”€â”€ locals.tf
â”œâ”€â”€ providers.tf
â”œâ”€â”€ versions.tf
â”œâ”€â”€ outputs.tf
â”œâ”€â”€ terraform.tfvars.example
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ rg/
â”‚   â”œâ”€â”€ network-hub/
â”‚   â”œâ”€â”€ network-spoke/
â”‚   â”œâ”€â”€ nsg/
â”‚   â”œâ”€â”€ nsg-subnet-assoc/
â”‚   â”œâ”€â”€ nsg-nic-assoc/
â”‚   â”œâ”€â”€ vm-linux/
â”‚   â”œâ”€â”€ peering/
â”‚   â””â”€â”€ private-endpoint-storage/
â””â”€â”€ docs/
    â”œâ”€â”€ architecture.md
    â””â”€â”€ troubleshooting.md
```

---

## ğŸš€ How to Deploy

### Prerequisites
- Azure subscription
- Azure CLI authenticated (`az login`)
- Terraform installed

### Deploy
```bash
cp terraform.tfvars.example terraform.tfvars
terraform init
terraform fmt -recursive
terraform validate
terraform apply
```

### Destroy
```bash
terraform destroy
```

---

## ğŸ” Networking & Access Model

- Public SSH allowed **only from your IP** (lab convenience)
- Spoke VMs have **no public IPs**
- Hub â†’ Spoke SSH enabled via NSG rules
- Hub subnet is dynamically discovered (no hardcoded CIDRs)

---

## ğŸ§  What This Lab Demonstrates

- Terraform module design and composition
- Hub-and-spoke Azure networking
- NSG rule design and source scoping
- VNet peering and private routing
- Handling Azure VM SKU capacity and quota limits
- Separation of network, security, and compute concerns

---

## âš ï¸ Real-World Issues Encountered

- VM deployment failures due to **regional SKU capacity**
- Subscription quota limits blocking VM families
- Incorrect NSG source ranges blocking access
- SSH authentication differences between local, hub, and spoke VMs

Details are documented in `docs/troubleshooting.md`.

---

## ğŸ› ï¸ Possible Improvements

- Replace public SSH with Azure Bastion
- Add NSG flow logs and Azure Monitor
- Introduce CI validation (Terraform fmt / validate)
- Harden jumpbox access

---

## ğŸ¯ Purpose

This lab was built to reinforce **Azure networking fundamentals**
and **Terraform best practices**, while reflecting issues commonly
encountered in real cloud operations environments.
